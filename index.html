<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>重要用語クイズ（カード式）</title>

    <style>
        body {
            font-family: system-ui, "Noto Sans JP", sans-serif;
            margin: 0;
            background: #f6f7f9;
            color: #111;
        }

        main {
            max-width: 980px;
            margin: 0 auto;
            padding: 16px;
        }

        .card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            padding: 16px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, .05);
        }

        h1 {
            font-size: 18px;
            margin: 0 0 8px;
        }

        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .muted {
            color: #6b7280;
            font-size: 12px;
        }

        .pill {
            font-size: 12px;
            color: #374151;
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 999px;
            display: inline-block;
        }

        .question {
            font-size: 18px;
            margin: 14px 0;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .choice {
            border: 1px solid #d1d5db;
            border-radius: 12px;
            padding: 10px 12px;
            cursor: pointer;
            background: #fff;
            margin-bottom: 8px;
            white-space: pre-wrap;
        }

        .choice:hover {
            background: #f3f4f6;
        }

        .choice.correct {
            background: #dcfce7;
            border-color: #22c55e;
        }

        .choice.wrong {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .explain {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #e5e7eb;
            white-space: pre-wrap;
        }

        button,
        select {
            border: 1px solid #d1d5db;
            background: #fff;
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer;
        }

        button:hover {
            background: #f3f4f6;
        }

        button.primary {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        button.primary:hover {
            background: #000;
        }

        .warn {
            color: #b45309;
        }
    
        /* ===== 追加：履歴/CSV/グラフ ===== */
        .modal[hidden] { display: none; }
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.35);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            z-index: 50;
        }
        .modal .panel {
            width: min(980px, 100%);
            max-height: 80vh;
            overflow: auto;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0,0,0,.15);
            padding: 14px;
        }
        .modal h2 {
            font-size: 16px;
            margin: 0 0 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        th, td {
            border-bottom: 1px solid #e5e7eb;
            padding: 8px 6px;
            vertical-align: top;
            text-align: left;
            white-space: nowrap;
        }
        td.wrap { white-space: normal; }
        .panel .row { margin-bottom: 10px; }
        canvas { width: 100%; height: 320px; border: 1px solid #e5e7eb; border-radius: 12px; }

    </style>
</head>

<body>
    <main>
        <div class="card">
            <h1>寝る前10分＆試験直前：重要用語 四択クイズ（カード式）</h1>

            <div class="row" style="justify-content: space-between;">
                <div class="row">
                    <label class="muted">章</label>
                    <select id="chapter">
                        <option value="ch1"selected>1章</option>
                        <option value="ch2">2章</option>
                        <option value="ch3">3章</option>
                        <option value="ch4">4章</option>
                        <option value="ch5">5章</option>
                        <option value="ch6">6章</option>
                        <option value="ch7">7章</option>
                        <option value="ch8">8章</option>
                        <option value="ch9">9章</option>
                        <option value="ch10">10章</option>
                        <option value="ch11">11章</option>
                        <option value="ch12">12章</option>
                        <option value="ch13">13章</option>
                        <option value="ch14">14章</option>
                        <option value="ch15">15章</option>
                        <option value="ch16">16章</option>
                        <option value="ch17">17章</option>
                        <option value="ch18">18章</option>
                        <option value="ch19">19章</option>
                        <option value="ch20">20章</option>
                        <option value="ch21">21章</option>
                    </select>

                    <label class="muted">出題</label>
                    <select id="direction">
                        <option value="forward">順引き（用語→定義）</option>
                        <option value="reverse">逆引き（定義→用語）</option>
                        <option value="mixed">ミックス</option>
                    </select>

                    <label class="muted">選択肢</label>
                    <select id="choiceMode">
                        <option value="def">定義で選ぶ</option>
                        <option value="term">用語で選ぶ</option>
                        <option value="auto" selected>自動（順=定義 / 逆=用語）</option>
                    </select>

                    <button id="shuffle">シャッフル</button>
                    <button id="ngMode">NGのみ</button>
                    <button id="allMode">全問</button>

                    <span class="muted" id="modeLabel"></span>
                    <span class="pill" id="metaPill"></span>
                    <span class="muted warn" id="dataWarn"></span>
                </div>

                <div class="row">
                    <div class="muted" id="progress"></div>
                    <div class="muted" id="score"></div>
                </div>
            </div>

            <div class="question" id="question"></div>
            <div id="choices"></div>
            <div class="explain" id="explain"></div>

            <div class="row" style="margin-top: 12px; justify-content: space-between;">
                <div class="row">
                    <button id="prev">戻る</button>
                    <button class="primary" id="next">次へ</button>
                </div>
                <div class="row">
                    <button id="restart">最初から</button>
                    <button id="resetStats">成績リセット</button>
                <button id="history">履歴を見る</button>
                    <button id="exportCsv">CSV出力</button>
                    <button id="showGraph">グラフ</button>
</div>
            </div>
        </div>
    
        <!-- ===== 追加：履歴モーダル ===== -->
        <div class="modal" id="historyModal" hidden>
            <div class="panel">
                <div class="row" style="justify-content: space-between;">
                    <h2>成績履歴（最新10件）</h2>
                    <button id="closeHistory">閉じる</button>
                </div>
                <div class="muted" id="historyHint"></div>
                <div style="margin-top:10px;">
                    <table>
                        <thead>
                            <tr>
                                <th>日時</th>
                                <th>章</th>
                                <th>モード</th>
                                <th>出題</th>
                                <th>選択肢</th>
                                <th>正答</th>
                                <th>総数</th>
                                <th>正答率</th>
                                <th class="wrap">理由</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ===== 追加：グラフモーダル ===== -->
        <div class="modal" id="graphModal" hidden>
            <div class="panel">
                <div class="row" style="justify-content: space-between;">
                    <h2>章ごとの平均正答率 推移（セッション別）</h2>
                    <button id="closeGraph">閉じる</button>
                </div>

                <div class="row">
                    <label class="muted">章</label>
                    <select id="graphChapter"></select>
                    <span class="muted">※履歴が無い章は表示されません</span>
                </div>

                <canvas id="rateChart" width="900" height="320"></canvas>
                <div class="muted" id="graphHint" style="margin-top:8px;"></div>
            </div>
        </div>

    </main>

    <!-- ===== カードデータ（章別）===== -->
    <script src="./data/cards-ch1.js"></script>
    <script src="./data/cards-ch2.js"></script>
    <script src="./data/cards-ch3.js"></script>
    <script src="./data/cards-ch4.js"></script>
    <script src="./data/cards-ch5.js"></script>
    <script src="./data/cards-ch6.js"></script>
    <script src="./data/cards-ch7.js"></script>
    <script src="./data/cards-ch8.js"></script>
    <script src="./data/cards-ch9.js"></script>
    <script src="./data/cards-ch10.js"></script>
    <script src="./data/cards-ch11.js"></script>
    <script src="./data/cards-ch12.js"></script>
    <script src="./data/cards-ch13.js"></script>
    <script src="./data/cards-ch14.js"></script>
    <script src="./data/cards-ch15.js"></script>
    <script src="./data/cards-ch16.js"></script>
    <script src="./data/cards-ch17.js"></script>
    <script src="./data/cards-ch18.js"></script>
    <script src="./data/cards-ch19.js"></script>
    <script src="./data/cards-ch20.js"></script>
    <script src="./data/cards-ch21.js"></script>

    <!-- ===== アプリ本体 ===== -->
    <script src="./app.js"></script>
</body>

</html>